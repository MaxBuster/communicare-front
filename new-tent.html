<!DOCTYPE html>
<html>
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script type="text/javascript" src='http://maps.google.com/maps/api/js?sensor=false&libraries=places'></script>
    <script src="js/locationpicker.jquery.js"></script>
</head>
<body>
<h1>It's time to add another awesome tent to our community!</h1>
<div style="width:45%;display: inline-block;">
    <label>
        Tent Name:<br>
        <input type="text" id="name">
    </label><br><br>
    <label>
        Organization:<br>
        <input type="text" id="organization">
    </label><br><br>
    <label>
        Type:<br>
        <select id="type">
            <option value="tent">Tent</option>
        </select>
    </label><br><br>
    <label>
        Services:<br>
        <input id="service" type="text"><button onclick="addService();">+</button>
        <textarea id="services" rows="10" disabled></textarea>
    </label>
    <br><br>
    <button type="submit" onclick="submit();">Create!</button>
</div>
<div id="somecomponent" style="width: 45%; height: 400px; display:inline-block;"></div>
<script>
    var services = [];
    var servicesUpper = [];
    var cLoc;

    function submit() {
        var orgId = '69b00a4fff6cb87b';
        var name = $('#name').val();
        var type = $('#type').val();
        var lat = cLoc.latitude;
        var long = cLoc.longitude;

        if(orgId.length && name.length && type.length) {
            var payload = {
                // TODO: Fix orgId!?!?!
                orgId: orgId,
                name: name,
                type: type,
                services: services,
                latitude: lat,
                longitude: long
            };
            console.log(payload);

            var post_request = $.post(
                    "https://archhack2016.herokuapp.com/tents", // Url to post org details to
                    payload
            );
            // Callback on post request success
            post_request.done(function() {
                alert("New tent added!");
            });
            // Callback on post request failure
            post_request.fail(function() {
                alert("New tent failed to add.");
            });
        }
    }

    function addService() {
        var service = $('#service').val();
        $('#service').val('');

        if(service.length > 0 && servicesUpper.indexOf(service.toUpperCase()) == -1) {
            services.push(service);
            servicesUpper.push(service.toUpperCase());
        }

        var servicesString = "";
        for (var i = 0; i < services.length; i++) {
            servicesString += services[i] + '\n';
        }
        $('#services').val(servicesString);
    }

    var locationPicker = $('#somecomponent').locationpicker({
        zoom:17,
        location: {
            latitude: 38.648434,
            longitude: -90.311079
        },
        radius: 10,
        inputBinding: {
            latitudeInput: $('#us6-lat'),
            longitudeInput: $('#us6-lon'),
            radiusInput: $('#us6-radius'),
            locationNameInput: $('#us6-address')
        },
        mapTypeId: 'satellite',
        markerInCenter: true,
        enableAutocomplete: true,
        onchanged: function(currentLocation, radius, isMarkerDropped) {
            cLoc = currentLocation;
        }
    });
</script>
</body>
</html>